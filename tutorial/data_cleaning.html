<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Data Cleaning &mdash; Specify lmpy 3.0.0a7+13.ga8d5cb9 documentation</title>
      <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
      <link rel="stylesheet" href="../_static/graphviz.css" type="text/css" />
    <link rel="shortcut icon" href="../_static/favicon.ico"/>
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
        <script src="../_static/jquery.js"></script>
        <script src="../_static/underscore.js"></script>
        <script src="../_static/doctools.js"></script>
    <script src="../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Layer Encoder" href="layer_encoder.html" />
    <link rel="prev" title="Build Shapegrid" href="build_grid.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
            <a href="../index.html" class="icon icon-home"> Specify lmpy
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Contents:</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../pages/installation.html">Installation</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="tutorial.html">Tutorials</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="build_grid.html">Build Shapegrid</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">Data Cleaning</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#introduction">Introduction</a></li>
<li class="toctree-l3"><a class="reference internal" href="#reading-a-csv-file">Reading a CSV File</a></li>
<li class="toctree-l3"><a class="reference internal" href="#reading-a-darwin-core-archive-file">Reading a Darwin Core Archive File</a></li>
<li class="toctree-l3"><a class="reference internal" href="#filtering-records">Filtering Records</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#built-in-filters">Built-in Filters</a></li>
<li class="toctree-l4"><a class="reference internal" href="#custom-filters">Custom Filters</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#modifying-records">Modifying Records</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#built-in-modifiers">Built-in Modifiers</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#putting-it-all-together">Putting It All Together</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#aggregate-and-clean-multiple-data-files">Aggregate and Clean Multiple Data Files</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="layer_encoder.html">Layer Encoder</a></li>
<li class="toctree-l2"><a class="reference internal" href="matrix.html">Matrix Objects</a></li>
<li class="toctree-l2"><a class="reference internal" href="mcpa.html">Metacommunity Phylogenetics Analysis (MCPA)</a></li>
<li class="toctree-l2"><a class="reference internal" href="occurrence_filters.html">Occurrence Filters</a></li>
<li class="toctree-l2"><a class="reference internal" href="pam_randomization.html">PAM Randomization and Null Models</a></li>
<li class="toctree-l2"><a class="reference internal" href="pam_statistics.html">PAM Statistics</a></li>
<li class="toctree-l2"><a class="reference internal" href="running_stats.html">Running Statistics</a></li>
<li class="toctree-l2"><a class="reference internal" href="tree.html">TreeWrapper Objects</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../pages/about.html">About</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pages/references.html">References</a></li>
<li class="toctree-l1"><a class="reference internal" href="../autoapi/index.html">API Reference</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">Specify lmpy</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../index.html" class="icon icon-home"></a> &raquo;</li>
          <li><a href="tutorial.html">Tutorials</a> &raquo;</li>
      <li>Data Cleaning</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../_sources/tutorial/data_cleaning.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="data-cleaning">
<h1>Data Cleaning<a class="headerlink" href="#data-cleaning" title="Permalink to this headline"></a></h1>
<section id="introduction">
<h2>Introduction<a class="headerlink" href="#introduction" title="Permalink to this headline"></a></h2>
<p>One of the first steps in creating species distribution models, let alone multi-species
analyses, is acquiring and preparing specimen occurrence records.  There are multiple
method for acquiring these raw specimen records such as aggregator downloads or API
calls but once you have the raw data, you need to assemble your entire dataset, which
involves converting records to a common format, grouping, and cleaning.  The lmpy
library provides tools for performing these aggregation and cleaning steps to greatly
simplify the process for the user.</p>
</section>
<section id="reading-a-csv-file">
<h2>Reading a CSV File<a class="headerlink" href="#reading-a-csv-file" title="Permalink to this headline"></a></h2>
<p>Read a CSV file that has fields “decimalLongitude” and “decimalLatitude” for x and y
and “speciesName” for the species binomial.</p>
<p>See: <a class="reference external" href="../autoapi/lmpy/point/index.html#lmpy.point.PointCsvReader">PointCsvReader</a></p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">reader</span> <span class="o">=</span> <span class="n">PointCsvReader</span><span class="p">(</span><span class="n">csv_filename</span><span class="p">,</span> <span class="s1">&#39;speciesName&#39;</span><span class="p">,</span> <span class="s1">&#39;decimalLongitude&#39;</span><span class="p">,</span> <span class="s1">&#39;decimalLatitude&#39;</span><span class="p">)</span>
</pre></div>
</div>
</section>
<section id="reading-a-darwin-core-archive-file">
<h2>Reading a Darwin Core Archive File<a class="headerlink" href="#reading-a-darwin-core-archive-file" title="Permalink to this headline"></a></h2>
<p>Read a Darwin Core Archive file.  The file is assumed to be valid and metadata will
be pulled from the ‘meta.xml’ file contained within the zip file.</p>
<p>See: <a class="reference external" href="../autoapi/lmpy/point/index.html#lmpy.point.PointDwcaReader">PointDwcaReader</a></p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">reader</span> <span class="o">=</span> <span class="n">PointDwcaReader</span><span class="p">(</span><span class="n">dwca_filename</span><span class="p">)</span>
</pre></div>
</div>
</section>
<section id="filtering-records">
<h2>Filtering Records<a class="headerlink" href="#filtering-records" title="Permalink to this headline"></a></h2>
<section id="built-in-filters">
<h3>Built-in Filters<a class="headerlink" href="#built-in-filters" title="Permalink to this headline"></a></h3>
<p>Filter a list of Point objects so that those with less than four (4) decimal places
of precision are removed.</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">points</span> <span class="o">=</span> <span class="p">[</span><span class="n">Point</span><span class="p">(</span><span class="s1">&#39;Species A&#39;</span><span class="p">,</span> <span class="mf">10.3</span><span class="p">,</span> <span class="mf">23.1</span><span class="p">),</span>
<span class="gp">... </span>   <span class="n">Point</span><span class="p">(</span><span class="s1">&#39;Species B&#39;</span><span class="p">,</span> <span class="mf">11.34123</span><span class="p">,</span> <span class="mf">12.2314</span><span class="p">),</span>
<span class="gp">... </span>   <span class="n">Point</span><span class="p">(</span><span class="s1">&#39;Species C&#39;</span><span class="p">,</span> <span class="mf">13.23131</span><span class="p">,</span> <span class="mf">18.3123</span><span class="p">)]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">precision_filter</span> <span class="o">=</span> <span class="n">get_decimal_precision_filter</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">flt_points</span> <span class="o">=</span> <span class="n">precision_filter</span><span class="p">(</span><span class="n">points</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="n">flt_points</span><span class="p">)</span>
<span class="go">[Point(&#39;Species B&#39;, 11.34123, 12.2314), Point(&#39;Species C&#39;, 13.23131, 18.3123)]</span>
</pre></div>
</div>
</section>
<section id="custom-filters">
<h3>Custom Filters<a class="headerlink" href="#custom-filters" title="Permalink to this headline"></a></h3>
<p>Filter a list of points so that those without a species epithet are removed.</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="k">def</span> <span class="nf">genus_filter_func</span><span class="p">(</span><span class="n">point</span><span class="p">):</span>
<span class="gp">... </span>    <span class="k">return</span> <span class="nb">len</span><span class="p">(</span><span class="n">point</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39; &#39;</span><span class="p">))</span> <span class="o">&gt;</span> <span class="mi">1</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">genus_filter</span> <span class="o">=</span> <span class="n">get_occurrence_filter</span><span class="p">(</span><span class="n">genus_filter_func</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">points</span> <span class="o">=</span> <span class="p">[</span><span class="n">Point</span><span class="p">(</span><span class="s1">&#39;Species A&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span>
<span class="gp">... </span>    <span class="n">Point</span><span class="p">(</span><span class="s1">&#39;Genus&#39;</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">),</span> <span class="n">Point</span><span class="p">(</span><span class="s1">&#39;Genus&#39;</span><span class="p">,</span> <span class="mi">9</span><span class="p">,</span> <span class="mi">3</span><span class="p">),</span> <span class="n">Point</span><span class="p">(</span><span class="s1">&#39;Species B&#39;</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">)]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">flt_points</span> <span class="o">=</span> <span class="n">genus_filter</span><span class="p">(</span><span class="n">points</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="n">flt_points</span><span class="p">)</span>
<span class="go">[Point(&#39;Species A&#39;, 1, 2), Point(&#39;Species B&#39;, 2, 1)]</span>
</pre></div>
</div>
</section>
</section>
<section id="modifying-records">
<h2>Modifying Records<a class="headerlink" href="#modifying-records" title="Permalink to this headline"></a></h2>
<section id="built-in-modifiers">
<h3>Built-in Modifiers<a class="headerlink" href="#built-in-modifiers" title="Permalink to this headline"></a></h3>
<p>Use the accepted name modifier with a file, ACCEPTED_TAXA_FILENAME, containing accepted
name mappings.</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">accepted_name_modifier</span> <span class="o">=</span> <span class="n">get_accepted_name_modifier</span><span class="p">(</span><span class="n">ACCEPTED_TAXA_FILENAME</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">points</span> <span class="o">=</span> <span class="p">[</span><span class="n">Point</span><span class="p">(</span><span class="s1">&#39;Accepted species&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span>
<span class="gp">... </span>    <span class="n">Point</span><span class="p">(</span><span class="s1">&#39;Synonym species&#39;</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">3</span><span class="p">),</span> <span class="n">Point</span><span class="p">(</span><span class="s1">&#39;Another synonym&#39;</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">4</span><span class="p">)]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">mod_points</span> <span class="o">=</span> <span class="n">accepted_name_modifier</span><span class="p">(</span><span class="n">points</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="n">mod_points</span><span class="p">)</span>
<span class="go">[Point(&#39;Accepted species&#39;, 1, 2), Point(&#39;Accepted species&#39;, 5, 3),</span>
<span class="go">Point(&#39;Accepted species&#39;, 4, 4)]</span>
</pre></div>
</div>
</section>
</section>
<section id="putting-it-all-together">
<h2>Putting It All Together<a class="headerlink" href="#putting-it-all-together" title="Permalink to this headline"></a></h2>
<section id="aggregate-and-clean-multiple-data-files">
<h3>Aggregate and Clean Multiple Data Files<a class="headerlink" href="#aggregate-and-clean-multiple-data-files" title="Permalink to this headline"></a></h3>
<p>For this example, we will process occurrence data from three sources, a Darwin Core
Archive, a JSON file, and a CSV file.  The Darwin Core Archive file is at
DWCA_FILENAME, the JSON data is at JSON_FILENAME and the records are under the ‘items’
key with ‘scientificName’ as the species key and ‘lon’ and ‘lat’ as the x and y keys
under the ‘geopoint’ key.  For the CSV file, CSV_FILENAME, the fields are ‘taxonName’,
‘decimalLongitude’, and ‘decimalLatitude’ for the species, x, and y fields
respectively.</p>
<p>First, define a modifier function that will ensure points from each source are in the
same format and only include species name, x, and y.  We can do this by only keeping
the attributes ‘species_name’, ‘x’, and ‘y’.  We will also send the points through an
accepted name modifier, with a mapping file at ACCEPTED_NAMES_FILENAME, to ensure that
the species name for each point is an accepted name.  We will define a chained modifier
function that we will utilize to apply both the accepted name modifier and the common
format modifier.  It is defined in the ‘get_chained_modifier’ function.</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">accepted_name_modifier</span> <span class="o">=</span> <span class="n">get_accepted_name_modifier</span><span class="p">(</span><span class="n">ACCEPTED_NAMES_FILENAME</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">def</span> <span class="nf">common_format_modifier</span><span class="p">(</span><span class="n">points</span><span class="p">):</span>
<span class="gp">... </span>    <span class="k">return</span> <span class="p">[</span><span class="n">Point</span><span class="p">(</span><span class="n">pt</span><span class="o">.</span><span class="n">species_name</span><span class="p">,</span> <span class="n">pt</span><span class="o">.</span><span class="n">x</span><span class="p">,</span> <span class="n">pt</span><span class="o">.</span><span class="n">y</span><span class="p">)</span> <span class="k">for</span> <span class="n">pt</span> <span class="ow">in</span> <span class="n">points</span><span class="p">]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">def</span> <span class="nf">get_chained_modifier</span><span class="p">(</span><span class="o">*</span><span class="n">modifiers</span><span class="p">):</span>
<span class="gp">... </span>    <span class="k">def</span> <span class="nf">chained_modifier</span><span class="p">(</span><span class="n">points</span><span class="p">):</span>
<span class="gp">... </span>        <span class="k">for</span> <span class="n">modifier</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">modifiers</span><span class="p">):</span>
<span class="gp">... </span>            <span class="n">points</span> <span class="o">=</span> <span class="n">modifier</span><span class="p">(</span><span class="n">points</span><span class="p">)</span>
<span class="gp">... </span>        <span class="k">return</span> <span class="n">points</span>
<span class="gp">... </span>    <span class="k">return</span> <span class="n">chained_modifier</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">chained_modifier</span> <span class="o">=</span> <span class="n">get_chained_modifier</span><span class="p">(</span>
<span class="gp">... </span>    <span class="n">accepted_name_modifier</span><span class="p">,</span>
<span class="gp">... </span>    <span class="n">common_format_modifier</span>
<span class="gp">... </span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">all_points</span> <span class="o">=</span> <span class="p">[]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c1"># Process the Darwin Core Archive</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">with</span> <span class="n">PointDwcaReader</span><span class="p">(</span><span class="n">DWCA_FILENAME</span><span class="p">)</span> <span class="k">as</span> <span class="n">dwca_reader</span><span class="p">:</span>
<span class="gp">... </span>    <span class="k">for</span> <span class="n">points</span> <span class="ow">in</span> <span class="n">dwca_reader</span><span class="p">:</span>
<span class="gp">... </span>        <span class="n">all_points</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">chained_modifier</span><span class="p">(</span><span class="n">points</span><span class="p">))</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c1"># Process the JSON file</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">JSON_FILENAME</span><span class="p">)</span> <span class="k">as</span> <span class="n">in_file</span><span class="p">:</span>
<span class="gp">... </span>    <span class="n">json_point_data</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">in_file</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">raw_json_points</span> <span class="o">=</span> <span class="p">[]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">json_point_data</span><span class="p">[</span><span class="s1">&#39;items&#39;</span><span class="p">]:</span>
<span class="gp">... </span>    <span class="n">raw_json_points</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
<span class="gp">... </span>        <span class="n">Point</span><span class="p">(</span>
<span class="gp">... </span>            <span class="n">item</span><span class="p">[</span><span class="s1">&#39;scientificName&#39;</span><span class="p">],</span>
<span class="gp">... </span>            <span class="n">item</span><span class="p">[</span><span class="s1">&#39;geopoint&#39;</span><span class="p">][</span><span class="s1">&#39;lon&#39;</span><span class="p">],</span>
<span class="gp">... </span>            <span class="n">item</span><span class="p">[</span><span class="s1">&#39;geopoint&#39;</span><span class="p">][</span><span class="s1">&#39;lat&#39;</span><span class="p">]</span>
<span class="gp">... </span>        <span class="p">)</span>
<span class="gp">... </span>    <span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c1"># For consistency, common format json points</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">all_points</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">chained_modifier</span><span class="p">(</span><span class="n">raw_json_points</span><span class="p">))</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c1"># Process the CSV file</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">with</span> <span class="n">PointCsvReader</span><span class="p">(</span>
<span class="gp">... </span>    <span class="n">CSV_FILENAME</span><span class="p">,</span>
<span class="gp">... </span>    <span class="s1">&#39;taxonName&#39;</span><span class="p">,</span>
<span class="gp">... </span>    <span class="s1">&#39;decimalLongitude&#39;</span><span class="p">,</span>
<span class="gp">... </span>    <span class="s1">&#39;decimalLatitude&#39;</span>
<span class="gp">... </span><span class="p">)</span> <span class="k">as</span> <span class="n">csv_reader</span><span class="p">:</span>
<span class="gp">... </span>    <span class="k">for</span> <span class="n">points</span> <span class="ow">in</span> <span class="n">csv_reader</span><span class="p">:</span>
<span class="gp">... </span>        <span class="n">all_points</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">chained_modifier</span><span class="p">(</span><span class="n">points</span><span class="p">))</span>
</pre></div>
</div>
<p>In this example, we assume that there are a reasonable number of points that can be
sorted at once.  For large datasets, it may be necessary to split the data first
before attempting to sort.  We will sort the points and write to a temporary file
because, when we read them from it, each group will contain all of the points for a
single species.</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="c1"># Sort points and write to a temporary file</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">temp_filename</span> <span class="o">=</span> <span class="n">tempfile</span><span class="o">.</span><span class="n">NamedTemporaryFile</span><span class="p">(</span><span class="n">suffix</span><span class="o">=</span><span class="s1">&#39;.csv&#39;</span><span class="p">,</span> <span class="n">delete</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span><span class="o">.</span><span class="n">name</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">with</span> <span class="n">PointCsvWriter</span><span class="p">(</span><span class="n">temp_filename</span><span class="p">,</span> <span class="s1">&#39;species_name&#39;</span><span class="p">,</span> <span class="s1">&#39;x&#39;</span><span class="p">,</span> <span class="s1">&#39;y&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">csv_writer</span><span class="p">:</span>
<span class="gp">... </span>    <span class="k">for</span> <span class="n">points</span> <span class="ow">in</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">all_points</span><span class="p">):</span>
<span class="gp">... </span>        <span class="n">csv_writer</span><span class="o">.</span><span class="n">write_points</span><span class="p">(</span><span class="n">points</span><span class="p">)</span>
</pre></div>
</div>
<p>Now we have an aggregated CSV file containing all of the specimen records from each of
the three sources that is grouped and sorted by species name.  Next, we will filter
the specimen records so that we only keep those with at least four decimal places of
precision, only unique localities, and only keep species with at least 12 points.
Write the cleaned data points to OUTPUT_POINTS_FILENAME.</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="c1"># Set up filters (except for duplicate localities)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">chain_filters</span> <span class="o">=</span> <span class="p">[</span>
<span class="gp">... </span>    <span class="n">get_decimal_precision_filter</span><span class="p">(</span><span class="mi">4</span><span class="p">),</span>
<span class="gp">... </span>    <span class="n">get_minimum_points_filter</span><span class="p">(</span><span class="mi">12</span><span class="p">),</span>
<span class="gp">... </span><span class="p">]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">with</span> <span class="n">PointCsvWriter</span><span class="p">(</span>
<span class="gp">... </span>    <span class="n">OUTPUT_POINTS_FILENAME</span><span class="p">,</span>
<span class="gp">... </span>    <span class="p">[</span><span class="s1">&#39;species_name, &#39;</span><span class="n">x</span><span class="s1">&#39;, &#39;</span><span class="n">y</span><span class="s1">&#39;]</span>
<span class="gp">... </span><span class="p">)</span> <span class="k">as</span> <span class="n">csv_writer</span><span class="p">:</span>
<span class="gp">... </span>    <span class="k">with</span> <span class="n">PointCsvReader</span><span class="p">(</span><span class="n">temp_filename</span><span class="p">,</span> <span class="s1">&#39;species_name&#39;</span><span class="p">,</span> <span class="s1">&#39;x&#39;</span><span class="p">,</span> <span class="s1">&#39;y&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">csv_reader</span><span class="p">:</span>
<span class="gp">... </span>        <span class="k">for</span> <span class="n">points</span> <span class="ow">in</span> <span class="n">csv_reader</span><span class="p">:</span>
<span class="gp">... </span>            <span class="n">dup_filter</span> <span class="o">=</span> <span class="n">get_unique_localities_filter</span><span class="p">()</span>
<span class="gp">... </span>            <span class="n">points</span> <span class="o">=</span> <span class="n">dup_filter</span><span class="p">(</span><span class="n">points</span><span class="p">)</span>
<span class="gp">... </span>            <span class="k">for</span> <span class="n">flt</span> <span class="ow">in</span> <span class="n">chain_filters</span><span class="p">:</span>
<span class="gp">... </span>                <span class="k">if</span> <span class="n">points</span><span class="p">:</span>  <span class="c1"># Stop trying to filter if there are no points</span>
<span class="gp">... </span>                    <span class="n">points</span> <span class="o">=</span> <span class="n">flt</span><span class="p">(</span><span class="n">points</span><span class="p">)</span>
<span class="gp">... </span>            <span class="n">dup_filter</span> <span class="o">=</span> <span class="kc">None</span>  <span class="c1"># Reset to preserve memory</span>
<span class="gp">... </span>            <span class="k">if</span> <span class="n">points</span><span class="p">:</span>  <span class="c1"># If any points remain, write them</span>
<span class="gp">... </span>                <span class="n">csv_writer</span><span class="o">.</span><span class="n">write_points</span><span class="p">(</span><span class="n">points</span><span class="p">)</span>
</pre></div>
</div>
<p>That’s it!  We have processed data from three sources, ensured that all records
have an accepted taxon name, filtered out records that have low coordinate decimal
precision, identified taxa with a minimum number of unique localities, to be able to use all of the resulting
data for computing species distribution models.</p>
</section>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="build_grid.html" class="btn btn-neutral float-left" title="Build Shapegrid" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="layer_encoder.html" class="btn btn-neutral float-right" title="Layer Encoder" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2022, Specify Lifemapper Team.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>